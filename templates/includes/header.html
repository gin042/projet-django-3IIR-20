{% load static %}
<header class="flex items-center justify-between bg-gray-800 h-20 px-8 text-white sticky top-0 z-40">
  <div>
    <a class="flex items-center gap-2" href="/" aria-label="Home">
      <img class="h-6" src="{% static 'images/logo.svg' %}" alt="Real-time Chat Logo" />
      <span class="text-lg font-bold">Real-time Chat</span>
    </a>
  </div>
  
  <nav class="block relative" aria-label="Main navigation">
    <ul class="flex items-center justify-center h-full gap-6">
      {% if request.user.is_authenticated %}
      <li><a href="/" class="hover:text-blue-300 transition-colors">Home</a></li>

      <!-- Chat Dropdown -->
      <li x-data="{ chatDropdownOpen: false }" class="relative">
        <button
          @click="chatDropdownOpen = !chatDropdownOpen"
          @click.away="chatDropdownOpen = false"
          class="flex items-center gap-1 hover:text-blue-300 transition-colors"
          aria-expanded="false"
          x-bind:aria-expanded="chatDropdownOpen"
          aria-haspopup="true"
        >
          Chats
          <svg
            x-bind:class="chatDropdownOpen && 'rotate-180'"
            class="w-4 h-4 transition-transform"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
          >
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
          </svg>
        </button>
        <div
          x-show="chatDropdownOpen"
          x-cloak
          class="absolute right-0 mt-2 bg-white text-gray-800 shadow-lg rounded-lg w-48 py-1 z-20"
          x-transition:enter="transition ease-out duration-200"
          x-transition:enter-start="opacity-0 translate-y-1"
          x-transition:enter-end="opacity-100 translate-y-0"
        >
          <a href="{% url 'home' %}" class="block px-4 py-2 hover:bg-gray-100">Public Chat</a>
          {% for chatroom in user.chat_groups.all %}
            {% if chatroom.groupchat_name %}
              <a href="{% url 'chatroom' chatroom.group_name %}" class="block px-4 py-2 hover:bg-gray-100 truncate">
                {{ chatroom.groupchat_name|truncatechars:24 }}
              </a>
            {% elif chatroom.is_private %}
              {% for member in chatroom.members.all %}
                {% if member != user %}
                  <a href="{% url 'chatroom' chatroom.group_name %}" class="block px-4 py-2 hover:bg-gray-100 truncate">
                    {{ member.profile.name|truncatechars:24 }}
                  </a>
                {% endif %}
              {% endfor %}
            {% endif %}
          {% empty %}
            <span class="block px-4 py-2 text-gray-500 text-sm">No chats available</span>
          {% endfor %}
        </div>
      </li>

      <!-- Profile Dropdown -->
      <li x-data="{ profileDropdownOpen: false }" class="relative">
        <button
          @click="profileDropdownOpen = !profileDropdownOpen"
          @click.away="profileDropdownOpen = false"
          class="flex items-center gap-2 hover:text-blue-300 transition-colors"
          aria-expanded="false"
          x-bind:aria-expanded="profileDropdownOpen"
          aria-haspopup="true"
        >
          <img
            class="h-8 w-8 rounded-full object-cover border border-gray-600"
            src="{{ request.user.profile.avatar|default:'/static/images/default-avatar.png' }}"
            alt="Profile picture"
            onerror="this.src='/static/images/default-avatar.png'"
          />
          <span class="truncate max-w-[120px]">{{ request.user.profile.name }}</span>
          <svg
            x-bind:class="profileDropdownOpen && 'rotate-180'"
            class="w-4 h-4 transition-transform"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
          >
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
          </svg>
        </button>
        <div
          x-show="profileDropdownOpen"
          x-cloak
          class="absolute right-0 mt-2 bg-white text-gray-800 shadow-lg rounded-lg w-48 py-1 z-20"
          x-transition:enter="transition ease-out duration-200"
          x-transition:enter-start="opacity-0 translate-y-1"
          x-transition:enter-end="opacity-100 translate-y-0"
        >
          <a href="{% url 'profile' %}" class="block px-4 py-2 hover:bg-gray-100">My Profile</a>
          <a href="{% url 'profile-edit' %}" class="block px-4 py-2 hover:bg-gray-100">Edit Profile</a>
          <a href="{% url 'new-groupchat' %}" class="block px-4 py-2 hover:bg-gray-100">Create Chat</a>
          <a href="{% url 'profile-settings' %}" class="block px-4 py-2 hover:bg-gray-100">Settings</a>
          <div class="border-t border-gray-200 my-1"></div>
          <a href="{% url 'account_logout' %}" class="block px-4 py-2 hover:bg-gray-100 text-red-600">Log Out</a>
        </div>
      </li>

      {% else %}
      <li><a href="{% url 'account_login' %}" class="hover:text-blue-300 transition-colors">Login</a></li>
      <li>
        <a href="{% url 'account_signup' %}?next={% url 'profile-onboarding' %}" class="hover:text-blue-300 transition-colors">
          Sign Up
        </a>
      </li>
      {% endif %}
    </ul>
  </nav>
</header>